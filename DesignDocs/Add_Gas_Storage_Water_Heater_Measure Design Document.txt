NREL Measure Design Document Text File

Note: you can include ruby snippets for arguments and messaged, but it isn't necessary. If you are comfortable with it, it makes writing the measure quicker if the code is already structured here.

EnergyPlus 8.1 documentation reference: http://bigladdersoftware.com/epx/docs/8-1/input-output-reference/page-008.html#sitewatermainstemperature

>> Start of XML content

Measure Name: 	Add OS:WaterHeater:Mixed-Storage-Gas
Measure Type: 	ModelMeasure

Tag		Service Hot Water.Water Heating

Description:
This measure adds an OS:WaterHeater:Mixed object representing a Natural Gas Storage Water Heater. Users will be asked to provide the following arguments
1) Use case, 2) Plant loop Assignment 3) Number of Bedrooms, 4) Number of Bathrooms, 5) Tank Volume, 6) Energy Factor, 7) detrated percentage of energy factor
8) Water HEater Location 9) Setpoint Temperature Schedule, 10) deadband temperature difference, 11) Water Heater Capacity, 12) Recovery Efficiency 13) Water Heater effectiveness and
 14) Heater Fuel Type


Model Description:
The measure will create a new instance of the OS:WaterHeater:Mixed object representing a Natural Gas Storage Water Heater. The object will either be assigned to an existing plant 
loop or create a new plant loop for assignment. The object will be configured be to use the user arguments. The EIO file will reports industry standard ratings of Recovery Efficiency 
and Energy Factor for water heater objects.

OpenStudio Version: 1.4.0

>> Start of Measure.rb content

Arguments:


1) 1) Choice list of use_case (Create a  water heater representing B10 Benchmark standard, Create a  water heater representing NCTH standard, Create a  water heater representing BA Pre-Retrofit Case standard, General)
	Required:		Yes
	Type: 			StringVector (List of use cases)
	Display Name: 		How will this measure be used?
	Default Value:		N/A
	NOTE: This choice will drive lookups into tables defined by 2014 Building America Simulation Protocol. 

2) number_Of_Bedrooms
	Required:		Yes
	Type: 			StringVector (1, 2, 3, 4, 5, 6 or more)
	Display Name: 		Number of Bedrooms in the Reference Home
	Default Value:		N/A

3) number_Of_Bathrooms
	Required:		Yes
	Type: 			StringVector (1, 1.5, 2, 2.5, 3, 3.5 or more) 
	Display Name: 		Number of Bathrooms in the Reference Home
	Default Value:		N/A
		
4) Choice list of existing_Plant_Loop_name
	Required:		Yes
	Type: 			StringVector (List of Plant Loops available in the model)
	Display Name: 		Plant Loop to assign Water heater as a Supply Equipment
	Default Value:		N/A
	NOTE: One choice should be to make a new heating water plant loop object 

5) storage_Tank_Volume
	Required:		Yes
	Type: 			DoubleArgument
	Display Name: 		Volume of the Storage Tank (gallons) of the Gas Storage Water Heater. Set to 0 to have Storage tank volume autosized. Set to -1 to follow 2104 BA House Protocols." 
	Default Value:		N/A
	## NOTE If object_to_be _created <> General this will be required to be a lookup

6) rated_Energy_Factor
	Required:		Yes
	Type: 			DoubleArgument
	Display Name: 		Rated Energy Factor of Gas Storage Tank Water Heater. This value shoud be entered as a percentage.
	Default Value:		N/A


7) derate_percentage_of_Rated_Energy_Factor
	Required:		Yes
	Type: 			DoubleArgument
	Display Name: 		Percent derate of rated Energy Factor, used to account for the performance derating or degradtion relative to the rated value. 
	Default Value:		N/A


8) shw_setpoint_Temperature
	Required:		Yes
	Type: 			Double Argument
	Display Name: 		Hot Water Setpoint Temperature (Deg F).
	Default Value:		125

9) deadband_Temperature_Difference
	Required:		Yes
	Type: 			DoubleArgument
	Display Name: 		The delta temperature difference [°F] between the setpoint and the “cut-in” temperature at 
				which the heater will turn on. In other words, the “cut-in” temperature is Setpoint – Deadband.
	Default Value:		3°F

10) water_Heater_Effectiveness
	Required:		Yes
	Type: 			DoubleArgument
	Display Name: 		Use-Side and Source-Side Effectiveness - representing heat exchanger efficiency. This number can be tuned to achieve results matching the GAMA rated EF 
				and RE outputs. Search the E+out.eoi output file to review the results for EF and RE
	Default Value:		1.0

11) Choice List of water_Heater_Location
	Required:		Yes
	Type: 			StringVector (List of Thermal Zones available in Model)
	Display Name: 		Thermal Zone where the Gas Storage Water Heater is located.
	Default Value:		N/A

12) water_Heater_Nominal_Capacity
	Required:		Yes
	Type: 			DoubleArgument
	Display Name: 		The nominal capacity [MBtu] of the gas storage water heater. Set to 0 to have this field autosized. Set to -1 to follow 2104 BA House Protocols."  
	Default Value:		N/A

13) water_Heater_recovery_efficiency 
	Required:		Yes
	Type: 			DoubleArgument
	Display Name: 		Rated Recovery Efficiency of the Water heater equal to the ratio of energy delivered to the water to the energy content of the fuel consumed by the weater heater. 
				Test procedures to test recovery efficiency are defined by by DOE in 10 CFR Part 430, Appendix E to Subpart B. Enter this number as a percent. This is used 
				by EnergyPlus as the thermal efficiency. Users will need to review the E+out.eio file to confirm Calculated recovery efficiency = Rated recovery efficiency.
	Default Value:		0.80

14) Choice list of water_heater_fuel_type
	Required:		Yes
	Type: 			StringVector (Natural Gas and Propane Gas)
	Display Name: 		The Type of Fuel used for heating.				
	Default Value:		Natural Gas



##Water heater performance data from here: https://www.ahridirectory.org/ahridirectory/pages/rwh/defaultSearch.aspx


Error Messages:

If OS.SizingPlant.loopType <> "Heating" then write error message "Water Heater must be adder to the supply side of an existing heating plant loop."
	
If shw_Setpoint_Temperature < 0 then write error message "Hot water temperature should be > 0."

If Storage Tank Volume < 0 and <> -1 then write error message "Storage Tank Volume cannot be < 0 gallons. Please correct."

If rated_Energy_Factor  > 1.0 then write error message "Rated Energy Factor has a maximum value of 1.0"

If rated_Energy_Factor < 0 and <> -1 then write error message "Rated Energy Factor must be > 0."

If derate_percentage_of_Rated_Energy_Factor > 100 write error message "Derate percentage must be less than 100."

If derate_percentage_of_Rated_Energy_Factor < 0 then write error message "Derate percentage must be >= 0."

If deadband_Temperature_Difference <=0 then write error message "Deadband Temperature Difference must be > 0 deg F."

If water_Heater_Effectiveness < 0 then write error message Gas Water Heater Heat Exchange Effectiveness must be > 0."

If water Heater_Effectiveness > 1 then write error message Gas Storage Water Heater Heat Exchange Effectiveness must be < 1."

If water_Heater_Nominal_Capacity < 0 and <> -1 then write error message "Gas Storage Water Heater Nominal Capacity must be > 0 MBtu."

If water_Heater_recovery_efficiency < 0 or > 1 then write error message "Gas Storage Water Heater Nominal Capacity must be > 0 MBtu."



Warning Messages:

If OS:Plant Loop already has a water heater attached, then write warning message "Additonal Water heater being added to <plantLoopNam>. User will need to confirm controls."
If new OS Plant loop is created then write warning message"The wate rheater will be applied to a new OS:PlantLoop object. The plant loop object will be created using defualt values
							   please review the values for appropriateness."

If shw_Setpoint_Temperature > 140 F then write warning message "Hot Water Setpoint schedule <schedule name> has values > 140F. This temperature, if achieved, may cause scalding."
If shw_Setpoint_Temperature < 120 F then write warning message""Hot Water Setpoint schedule <schedule name> has values < 120F. This temperature may promote the growth of Legionellae or other bacteria."

If Storage Tank Volume < 25 then write warning message "A storage tank volume of less than 25 gallons and a certified rating is not commercially available. Please review the input."
If Storage Tank Volume > 100 then write warning message "A hot watter heater with a storage tank volume of greater than 100 gallons and a certified rating is not commercially available."

If rated_Energy_Factor < 0.48 then write warning message "Rated Energy Factor for Commercially available Gas Storage Type Water Heaters should be > 0.48."  #Source: AHRI
If rated_Energy_Factor > 0.82 then write warning message "Rated Energy Factor for Commercially available Gas Storage Type Water Heaters should be < 0.82."  #Source: AHRI	


If derate_percentage_of_Rated_Energy_Factor > 15 then write warning message "Parformance degradation factor of <x>% associated with Installed Energy Factor appears to be extreme."
	
If deadband_Temperature_Difference > 15 Deg F then write warning message "Deadband Temperature Difference should be < 15 Deg F."

If Water_Heater_Effectiveness < 0.80 then write warning message "Actual Performance of modeled water heater may not match Rated EF and RE per 
								GAMA and 10CFR430 test procedures. Check EPlusout.eio file for calcuklated EF and RE."

If water_Heater_Nominal_Capacity < 25 MBtu then write warning message"Commercially Available Gas Storage Water Heaters should have a minimum Nominal Capacity of 25 MBtu."
If Water_Heater_Nominal_Capacity > 75 MBtu then write warning message"Commercially Available Gas Storage Water Heaters should have a maximum Nominal Capacity of 75 MBtu."


If water_Heater_recovery_efficiency < 0.70 MBtu then write warning message"Commercially Available Gas Storage Water Heaters should have a minimum reated recovery efficiency of 70%."
If water_Heater_recovery_efficiency > 0.90 MBtu then write warning message"Commercially Available Gas Storage Water Heaters should have a maximum recovery efficiency of 90%."


If Use_Case <> General then write warning message "BA protocols require water heater location to be in attached garage (if climate = hot-humid or 
									    hot-dry) or unconditioned basement (if climate = all others). Please check table 9 of 2014 simulation protocols."


Not Applicable Messages:

None

Initial Conditions:

#Report any current names and associated plant loop name of existing OS:WaterHeater:Mixed object with a tank volume > 2.0 gallon and a fuel type = (PropaneGas or NaturalGas).
Report Size (gal) and nominal Capacity (MBtu) of each object.


Final Condition:

#If new Hot Water plant loop was created, report the name of the new hot water loop. Report the name of new OS:WaterHeater:Mixed object. Report Size (gal) and nominal Capacity (MBtu) of each object.

Code Outline:


>> Start of MyMeasure_Test.rb content

# Get arguments from user

# convert argument method variable into run method variables

# test run method variable for warning messages

# test model for N/A message

# Write Initial Conditions message

# Convert all input variables collected in IP units into SI equivalents (Farenheit to Celcius, etc.)  ##E+ works in SI only##


IF new plant loop needed 

	## Create a new plant loop

	    	shw_loop = OpenStudio::Model::PlantLoop.new(model)
	    	shw_loop.setName("Service Hot Water Loop")
    		shw_sizing_plant = shw_loop.sizingPlant
    		shw_sizing_plant.setLoopType("Heating")
    		shw_sizing_plant.setDesignLoopExitTemperature(60) # note 60 Deg C = 150 F
    		shw_sizing_plant.setLoopDesignTemperatureDifference(50) # Note 60C - 10C = 50C   

       	## Create a new pump

    		shw_pump = OpenStudio::Model::PumpConstantSpeed.new(model)


	## Configure pump for consuming near zero energy

		shw_pump.setFractionofMotorInefficienciestoFluidStream(1)
		shw_pump.setMotorEfficiency(0.999)
		shw_pump.ratedFlowRate(autosized)
		shw_pump.setPumpControlType(Intermittent)
		shw_pump.setRatedPowerConsumption(0.001)
		shw_pump.setRatedPumpHead(0.001)


	## create shw system bypass pipe
		
		shw_heater_bypass_pipe = OpenStudio::Model::PipeAdiabatic.new(model)
        
    	## create shw supply outlet pipe

		shw_supply_outlet_pipe = OpenStudio::Model::PipeAdiabatic.new(model) 

	## create schedule for hot water heater temperature and create a new scheduled setpoint manager to assign the schedule to 

		shw_t_c = OpenStudio::convert(shw_Setpoint_Temperature,"F","C").get
    		shw_t_sch = OpenStudio::Model::ScheduleRuleset.new(model)
    		shw_t_sch.setName("SHW Temp")
    		shw_t_sch.defaultDaySchedule().setName("HW Temp Default")
    		shw_t_sch.defaultDaySchedule().addValue(OpenStudio::Time.new(0,24,0,0),shw_t_c)
    		shw_t_stpt_manager = OpenStudio::Model::SetpointManagerScheduled.new(model,shw_t_sch)
	

	## create new water heater object

		shw_heater = OpenStudio::Model::WaterHeaterMixed.new(model)

	## Configure new water heater object

		(See details below)
                                                    
    	## Add the components to the service water loop

    		shw_supply_inlet_node = shw_loop.supplyInletNode
    		shw_supply_outlet_node = shw_loop.supplyOutletNode
    		shw_pump.addToNode(shw_supply_inlet_node)
    		shw_loop.addSupplyBranchForComponent(shw_heater)
    		shw_loop.addSupplyBranchForComponent(shw_bypass_pipe)
    		shw_supply_outlet_pipe.addToNode(shw_supply_outlet_node)
  	   
  	## Add setpoint manager to supply outlet node

  		shw_t_stpt_manager.addToNode(shw_supply_outlet_node) 

If existing plant loop selected

	
	## Choose loop from selected loop 

		shw_loop = OpenStudio::Model::PlantLoop.name(existing_Plant_Loop_name)  ##NOT SURE IF THIS WILL WORK## 

       	## See if loop pump already exists within slected plant loop, if not then create a new pump

		    		
		If shw_pump.name = "empty" then shw_pump = OpenStudio::Model::PumpConstantSpeed.new(model)  ##CERTAIN THAT THIS WILL NOT WORK##

	## If a new pump is created, configure new pump for consuming near zero energy

		shw_pump.setFractionofMotorInefficienciestoFluidStream(1)
		shw_pump.setMotorEfficiency(0.999)
		shw_pump.ratedFlowRate(autosized)
		shw_pump.setPumpControlType(Intermittent)
		shw_pump.setRatedPowerConsumption(0.001)
		shw_pump.setRatedPumpHead(0.001)

	## create schedule for hot water heater temperature and create a new scheduled setpoint manager to assign the schedule to 

		shw_t_c = OpenStudio::convert(shw_Setpoint_Temperature,"F","C").get
    		shw_t_sch = OpenStudio::Model::ScheduleRuleset.new(model)
    		shw_t_sch.setName("SHW Temp")
    		shw_t_sch.defaultDaySchedule().setName("HW Temp Default")
    		shw_t_sch.defaultDaySchedule().addValue(OpenStudio::Time.new(0,24,0,0),shw_t_c)

	## create new water heater object

		shw_heater = OpenStudio::Model::WaterHeaterMixed.new(model)

	## Configure new water heater object

		(See details below)
                                                     
    	## Add new water heater to the existing service water loop

		shw_loop.addSupplyBranchForComponent(shw_heater)

	## If new pump created add to existing loop

    		shw_pump.addToNode(shw_supply_inlet_node)
  
	
	##Check what is on the supply outlet node of the existing loop - setpoint manager or something else.  ## needs to be written in ruby###
		
	## If a new setpoint manager is needed, create one and assign it to the supply outlet node..

		shw_t_stpt_manager = OpenStudio::Model::SetpointManagerScheduled.new(model,setpoint_Temperature_Schedule_Name)
		shw_t_stpt_manager.addToNode(shw_supply_outlet_node) 

	##Write initial conditions message
	
		
	
	##write final conditions message

		NOTE: Many of the info statements could be written as final conditions messages. This is semantics - info messages are meant to inform the user when a change was made. Final 
			condition messages are meant to summarize the changes made (as compared to the inital condition) as a single message.

___________________________________________

## NOTE this section describes line by line how to assign attributes to the OS:WaterHeater:mixed object properties


	1) attribute setTankVolume 

		if use_case = NCTH or B10 Benchmark then 

			shw_heater.storage_Tank_Volume = result of lookup of Electric Storage Tank table (#bdr,#bath). ## NOTE Convert to m3 units for assignment) 

			write info message of use_case and shw_heater.storage_Tank_Volume

		if use_case = BA Retrofit then 

			shw_heater.storage_Tank_Volume(storage_Tank_Volume), write info message printed of use case and volume
			
			write info message of use_case and shw_heater.storage_Tank_Volume

		if use_case = General and storage_Tank_Volume = 0 then

			shw_heater.setTankVolume("Autosized").

			write info message of use_case and shw_heater.storage_Tank_Volume

			else shw_heater.setTankVolume(storage_Tank_Volume)
			
			write info message of use_case and shw_heater.storage_Tank_Volume

	2) attribute setSetpointTemperatureSchedule 

		if use_case = NCTH or B10 Benchmark or BA Retrofit then 

			create a use schedule where Tsetpoint = constant 120F schedule (all 8760 hours) 

			assign new use schedule to shw_heater.setpoint_Temperature_Schedule_Name 

			shw_heater.setSetpointTemperatureSchedule(setpoint_Temperature_Schedule_Name)			

			write info message of shw_heater.setpoint_Temperature_Schedule_Name

		if use_case = General then 

			create a new hot water temp schedule where Tsetpoint = shw_Setpoint_Temperature

			assign the created temp schedule to shw_heater.setpoint_Temperature_Schedule_Name 

			shw_heater.setSetpointTemperatureSchedule(setpoint_Temperature_Schedule_Name)			

			write info message of shw_heater.setpoint_Temperature_Schedule_Name and schedule value			
			


	3) attribute setDeadbandTemperatureDifference
		
		if use_case = NCTH or B10 Benchmark or BA Retrofit then

			shw_heater.setDeadbandTemperatureDifference(6.111) ## Note convert 15F to Celcius)

			write info message of shw_heater.DeadbandTemperatureDifference

		if use_case = General then 

			shw_heater.setDeadbandTemperatureDifference(deadband_Temperature_Difference)

			write info message of shw_heater.DeadbandTemperatureDifference

	4) attribute shw_heater.setMaximumTemperatureLimit(100) ##Note: Input is in Deg C, 212 converted to Deg C for OS assignment.

			write info message of shw_heater.MaximumTemperatureLimit
	
	5) attribute shw_heater.setHeaterControlType("Cycle")

			write info message of shw_heater.HeaterControlType

	6) attribute shw_heater.setHeaterMaximumCapacity 
	
		if use_case = NCTH or B10 Benchmark then 

			shw_heater.setHeaterMaximumCapacity =  lookup result of lookup of Electric Storage Tank table (#bdr,#bath). ## NOTE units need to be in W

			write info message of shw_heater.HeaterMaximumCapacity

		if use_case = BA Retrofit then 
			
				if water_Heater_Nominal_Capacity = 0, then 
			
					shw_heater.setHeaterMaximumCapacity("Autosize")

					write info message of shw_heater.HeaterMaximumCapacity

				else 
	
					shw_heater.setHeaterMaximumCapacity(water_Heater_Nominal_Capacity)

					write info message of shw_heater.HeaterMaximumCapacity

		if use_case = General then  

				if water_Heater_Nominal_Capacity = 0, then 

					shw_heater.setHeaterMaximumCapacity("Autosize")

					write info message of shw_heater.HeaterMaximumCapacity

				else 

					shw_heater.setHeaterMaximumCapacity(water_Heater_Nominal_Capacity)

					write info message of shw_heater.HeaterMaximumCapacity

	7) attribute shw_heater.setHeaterMinimumCapacity(0)

			write info message of shw_heater.HeaterMinimumCapacity

	8) attribute shw_heater.setHeaterFuelType(water_heater_fuel_type)

			write info message of shw_heater.HeaterFuelType

	9) attribute shw_heater.setHeaterThermalEfficiency(water_Heater_recovery_efficiency)

			write info message of shw_heater.HeaterThermalEfficiency

	10) attribute shw_heater.setPartLoadFactorCurve = OPTIONAL - NOT USED

	11) attribute shw_heater.setOffCycleParasiticFuelConsumptionRate = OPTIONAL - NOT USED

	12) attribute shw_heater.setOffCycleParasiticFuelType = OPTIONAL - NOT USED

	13) attribute shw_heater.setOffCycleParasiticHeatFractiontoTank = OPTIONAL - NOT USED

	14) attribute shw_heater.setOnCycleParasiticFuelConsumptionRate - OPTIONAL - NOT USED

	15) attribute shw_heater.setOnCycleParasiticFuelType = OPTIONAL - NOT USED

	16) attribute shw_heater.setOnCycleParasiticHeatFractiontoTank = OPTIONAL - NOT USED

	17) attribute shw_heater.setAmbientTemperatureIndicator("Zone")

			write info message of shw_heater.AmbientTemperatureIndicator

	18) attribute shw_heater.setAmbientTemperatureSchedule = OPTIONAL - NOT USED
	
	19) attribute shw_heater.setAmbientTemperatureThermalZone = water_Heater_Location

	20) attribute shw_heater.setAmbientTemperatureOutdoorAirNodeName = OPTIONAL - NOT USED

	21) attribute shw_heater.setOffCycleLossCoefficienttoAmbientTemperature  ##SOurce = Cell R4594, Options Sheet of BA_Analysis_FY10.xlsm spreadsheet


		##Note Equation Source = Options tab of BA Analysis Spreadsheet
		
		TTank = AVG(setpoint_Temperature_Schedule_Name) + 15 deg F
		Assume TEnvironment = 67.5 F 

		UA = ((water_Heater_recovery_efficiency*(1-derate_percentage_of_Rated_Energy_Factor))/(rated_Energy_Factor*(1-derate_percentage_of_Rated_Energy_Factor))-1)/((TTank-67.5)*(24/41073-1/(water_Heater_Nominal_Capacity*(rated_Energy_Factor*(1-derate_percentage_of_Rated_Energy_Factor))))))
		 
    		## Note: reasonable values of UA should be ~ 10 or less. (UA units should be Btu/hr-F)
		
		convert UA into Watts/Kelvin for input into OpenStudio

		shw_heater.setOffCycleLossCoefficienttoAmbientTemperature(converted result of UA)

		write info message of shw_heater.OffCycleLossCoefficienttoAmbientTemperature

	22) attribute shw_heater.setOffCycleLossFractiontoThermalZone = 1.0

		write info message of shw_heater.OffCycleLossFractiontoThermalZone 

	23) attribute shw_heater.setOnCycleLossCoefficienttoAmbientTemperature = convert off_cycle_loss

		write info message of shw_heater.OnCycleLossCoefficienttoAmbientTemperature 

	24) attribute shw_heater.setOnCycleLossFractiontoThermalZone = 1.0

		write info message of shw_heater.OnCycleLossFractiontoThermalZone

	25) attribute shw_heater.setPeakUseFlowRate = OPTIONAL - NOT USED

	26) attribute shw_heater.setUseFlowRateFractionSchedule = OPTIONAL - NOT USED

	27) attibute shw_heater.setColdWaterSupplyTemperatureSchedule = OPTIONAL - NOT USED

	28) attribute shw_heater.setUseSideEffectiveness = water_Heater_Effectiveness

		write info message of shw_heater.UseSideEffectiveness

	29) attribute shw_heater.setSourceSideEffectiveness = water_Heater_Effectiveness

		write info message of shw_heater.SourceSideEffectiveness

	30) attribute shw_heater.setUseSideDesignFlowRate = "autosize"

	31) attribute shw_heater.setSourceSideDesignFlowRate = OPTIONAL - NOT USED

	32) attribute shw_heater.setIndirectWaterHeatingRecoveryTime - OPTIONAL - Not Used


## End of description of OS:waterHeater:Mixed object
_______________________________________________________________________


## End of measure


Measure Tests:  ## NOTE THIS IS NOT COMPLETE ##

Need to create a model with 

1) No existing hot water system, but empty 
# get arguments and test that they are what we are expecting
# set arguments to bad values and see that it fails as expected
# set arguments to match E+ idd default values 
# set arguments to good values (not default values)
# Run twice, set arguments to good values on model working default


